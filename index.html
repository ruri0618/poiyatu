const members = [
    "ç”Ÿç”°è¡£æ¢¨å¥ˆ", "å°ç”°ã•ãã‚‰", "é‡ä¸­ç¾å¸Œ", "ç‰§é‡çœŸè‰æ„›", "ç¾½è³€æœ±éŸ³", "æ¨ªå±±ç²å¥ˆ", "åŒ—å·è‰å¤®", "å²¡æ‘ã»ã¾ã‚Œ", "å±±ï¨‘æ„›ç”Ÿ", "æ«»äº•æ¢¨å¤®", "äº•ä¸Šæ˜¥è¯", "å¼“æ¡æœ±ç´",
    "ä¸Šåœ‹æ–™èŒè¡£", "ä¼Šå‹¢éˆ´è˜­", "æ©‹è¿«éˆ´", "å·åå‡œ", "ç‚ºæ°¸å¹¸éŸ³", "æ¾æœ¬ã‚ã‹ãª", "å¹³å±±éŠå­£", "ä¸‹äº•è°·å¹¸ç©‚", "å¾Œè—¤èŠ±",
    "æ®µåŸç‘ ã€…", "äº•ä¸Šç²éŸ³", "å·¥è—¤ç”±æ„›", "æ¾æ°¸é‡Œæ„›", "æœ‰æ¾¤ä¸€è¯", "å…¥æ±Ÿé‡Œå’²", "æ±Ÿç«¯å¦ƒå’²", "çŸ³å±±å’²è‰¯", "é è—¤å½©åŠ é‡Œ",
    "å·å¶‹ç¾æ¥“", "è°·æœ¬å®‰ç¾", "å°é‡ç‘æ­©", "å°é‡ç”°ç´—æ ", "ç§‹å±±çœç·’", "æ²³è¥¿çµå¿ƒ", "å…«æœ¨æ ", "ç¦ç”°çœŸç³", "è±«é¢¨ç‘ ä¹ƒ",
    "çŸ³äº•æ³‰ç¾½", "æ‘ç”°çµç”Ÿ", "åœŸå±…æ¥“å¥", "å³¶å€‰ã‚Šã‹", "è¥¿ç”°æ±é‡Œ", "æ±Ÿå£ç´—è€¶", "é«˜ç€¬ãã‚‹ã¿", "å‰ç”°ã“ã“ã‚", "å²¡æ‘ç¾æ³¢",
    "æ¸…é‡æ¡ƒã€…å§«", "å¹³äº•ç¾è‘‰", "é‡Œå‰ã†ãŸã®", "å°æ—èŒèŠ±", "æ–‰è—¤å††é¦™", "åºƒæœ¬ç‘ ç’ƒ", "ç±³æ‘å§«è‰¯ã€…", "çªªç”°ä¸ƒæµ·", "ä¸­å±±å¤æœˆå§«",
    "è¥¿ï¨‘ç¾ç©º", "åŒ—åŸã‚‚ã‚‚", "ç­’äº•æ¾ªå¿ƒ", "æ©‹ç”°æ­©æœ", "å‰ç”°å§«æ·", "å°é‡ç”°è¯å‡œ", "æ‘è¶Šå½©èœ", "æ¤æ‘è‘‰ç´”", "æ¾åŸãƒ¦ãƒªãƒ¤",
    "å³¶å·æ³¢èœ", "ä¸Šæ‘éº—èœ", "ç›¸é¦¬å„ªèŠ½"
];

function drawGacha(times, untilSR = false, targetMember = null) {
    let results = [];
    let count = 0;
    let srHit = false;
    let oshiResultIndex = -1;

    do {
        const member = members[Math.floor(Math.random() * members.length)];
        const rarity = getRandomRarity();
        let item = "";
        let rarityTag = rarity;

        if (rarity === "N") {
            item = Math.random() < 0.5 ? "ç¼¶ãƒãƒƒã‚¸" : "ã‚¹ãƒ†ãƒƒã‚«ãƒ¼";
            rarityTag = item;
        } else if (rarity === "R") item = "ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼";
        else if (rarity === "SR") item = "BIGã‚¢ã‚¯ãƒªãƒ«ã‚¹ã‚¿ãƒ³ãƒ‰";

        let displayText = rarity === "SR" ? `<span class='rainbow-text'>${rarity}ï¼š${member} - ${item}</span>` : `${rarity}ï¼š${member} - ${item}`;

        results.push({ rarity: rarityTag, member: member, item: item, display: displayText });

        if (untilSR && rarity === "SR" && (!targetMember || member === targetMember)) {
            srHit = true;
            if (targetMember) {
                oshiResultIndex = results.length - 1;
            }
            break;
        }

        count++;
    } while (count < times || untilSR);

    results.sort((a, b) => {
        const rarityOrder = { "SR": 0, "R": 1, "ç¼¶ãƒãƒƒã‚¸": 2, "ã‚¹ãƒ†ãƒƒã‚«ãƒ¼": 3 };
        if (rarityOrder[a.rarity] !== rarityOrder[b.rarity]) {
            return rarityOrder[a.rarity] - rarityOrder[b.rarity];
        }
        if (a.rarity === "ç¼¶ãƒãƒƒã‚¸" || a.rarity === "ã‚¹ãƒ†ãƒƒã‚«ãƒ¼") {
            return a.rarity.localeCompare(b.rarity);
        }
        return members.indexOf(a.member) - members.indexOf(b.member);
    });

    // æ¨ã—SRãŒå‡ºãŸå ´åˆã¯ä¸€ç•ªä¸Šã«ç§»å‹•ã—ã¦ãƒ•ã‚©ãƒ³ãƒˆå¤§ãã‚ã«ã™ã‚‹
    if (oshiResultIndex !== -1) {
        const oshiResult = results.splice(oshiResultIndex, 1)[0];
        oshiResult.display = `<span style="font-size:24px; font-weight:bold; color:#FF69B4;">SRï¼š${oshiResult.member} - BIGã‚¢ã‚¯ãƒªãƒ«ã‚¹ã‚¿ãƒ³ãƒ‰âœ¨</span>`;
        results.unshift(oshiResult);
    }

    let displayText = results.map(r => r.display).join("<br>");
    if (untilSR && srHit) {
        const totalCost = count * 500;
        displayText = `ğŸ‰âœ¨ğŸŠ ${count}å›ã§SRãŒå‡ºã¾ã—ãŸï¼ï¼ˆåˆè¨ˆ ${totalCost.toLocaleString()}å††ï¼‰ğŸŠâœ¨ğŸ‰<br><br>` + displayText;
    }

    document.getElementById("result").innerHTML = displayText;
}
